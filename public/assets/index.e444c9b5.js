import{r as d,o as c,c as _,t as v,a as S,b as i,d as a,w as p,e as y,f as b,F as I,m as P,g as M,n as A,h as D,i as J,j as L,v as B,k,l as q,C as z,p as G,D as H,q as j,s as K,u as W,x as Y,y as Q}from"./vendor.163fc97a.js";const X=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))l(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&l(r)}).observe(document,{childList:!0,subtree:!0});function s(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerpolicy&&(n.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?n.credentials="include":o.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function l(o){if(o.ep)return;o.ep=!0;const n=s(o);fetch(o.href,n)}};X();var h=(e,t)=>{const s=e.__vccOpts||e;for(const[l,o]of t)s[l]=o;return s};const Z={props:["fullName"]},ee={class:"main-header"},te=i("div",{class:"main-header-logo"},"Logo",-1),oe={key:0,class:"curr-user"},se={class:"main-header-nav"},ne={class:"main-nav clean-list flex"},re=y("Dashboard"),ae=y("Toys"),le=y("Login");function ie(e,t,s,l,o,n){const r=d("router-link");return c(),_("header",ee,[te,s.fullName?(c(),_("div",oe," Logged in user: "+v(s.fullName),1)):S("",!0),i("nav",se,[i("ul",ne,[i("li",null,[a(r,{to:"/"},{default:p(()=>[re]),_:1})]),i("li",null,[a(r,{to:"/toy"},{default:p(()=>[ae]),_:1})]),i("li",null,[a(r,{to:"/user"},{default:p(()=>[le]),_:1})])])])])}var ue=h(Z,[["render",ie]]);const ce={name:"app",data(){return{isReady:!1}},async created(){try{await this.$store.dispatch("loadToys"),await this.$store.commit("loadLoggedInUser"),this.isReady=!0}catch{this.$store.commit({type:"setIsError",isError:!0})}},computed:{isError(){return this.$store.getters.isError},loggedInUserFullName(){const e=this.$store.getters.loggedInUser;return e?e.fullname:""}},components:{appHeader:ue}},de={key:1},pe={key:2};function _e(e,t,s,l,o,n){const r=d("app-header"),u=d("router-view");return c(),_(I,null,[a(r,{fullName:n.loggedInUserFullName},null,8,["fullName"]),o.isReady?(c(),b(u,{key:0})):n.isError?(c(),_("div",pe,"Sorry! we had an oopsie, try again later")):(c(),_("div",de,"Loading..."))],64)}var me=h(ce,[["render",_e]]);const ye={props:{_id:String},created(){},data(){return{menuIcon:P,closeIcon:M,isActions:!1}},methods:{toggleActions(){this.isActions=!this.isActions},removeToy(e){this.$store.dispatch({type:"removeToy",_id:e})}},computed:{editPath(){return`/toy/edit/${this._id}`},detailsPath(){return`/toy/${this._id}`},btnIcon(){return this.isActions?this.closeIcon:this.menuIcon},open(){return{open:this.isActions}}},unmounted(){}},he=y("Edit"),ge=y("See More");function fe(e,t,s,l,o,n){const r=d("el-button"),u=d("router-link"),m=d("el-button-group");return s._id?(c(),_("section",{key:0,class:A(["item-actions",n.open])},[a(r,{type:"primary",icon:n.btnIcon,onClick:n.toggleActions},null,8,["icon","onClick"]),o.isActions?(c(),b(m,{key:0},{default:p(()=>[a(u,{to:n.editPath,class:"btn"},{default:p(()=>[he]),_:1},8,["to"]),a(u,{to:n.detailsPath,class:"btn"},{default:p(()=>[ge]),_:1},8,["to"]),i("button",{onClick:t[0]||(t[0]=C=>n.removeToy(s._id)),class:"btn"},"Delete")]),_:1})):S("",!0)],2)):S("",!0)}var ve=h(ye,[["render",fe]]);const $e={props:{toy:{type:Object,required:!0}},components:{itemActions:ve},created(){},data(){return{}},methods:{},computed:{isInStockTxt(){return this.toy.inStock?"In stock":"Out of stock"},isInStockClass(){return{"in-stock":this.toy.inStock}}},unmounted(){}},be={class:"toy-preview-container"},we=i("span",null,"Name:",-1),Se=i("br",null,null,-1);function Ie(e,t,s,l,o,n){const r=d("item-actions"),u=d("el-card");return c(),_("li",be,[a(u,{class:"toy-preview",shadow:"hover"},{header:p(()=>[a(r,{_id:s.toy._id},null,8,["_id"])]),default:p(()=>[i("p",null,[we,Se,i("span",null,v(s.toy.name),1)]),i("span",null,"Price: "+v(s.toy.price),1),i("span",{class:A(["stock-status",n.isInStockClass])},v(n.isInStockTxt),3)]),_:1})])}var ke=h($e,[["render",Ie]]);const Ee={props:{toys:{type:Array,required:!0}},components:{toyPreview:ke},created(){},data(){return{}},methods:{},computed:{},unmounted(){}},Te={class:"gallery toy-app-list clean-list"};function Ue(e,t,s,l,o,n){const r=d("toy-preview");return c(),_("ul",Te,[(c(!0),_(I,null,D(s.toys,u=>(c(),b(r,{toy:u,key:u._id},null,8,["toy"]))),128))])}var xe=h(Ee,[["render",Ue]]);const Le={name:"toy-filter",data(){return{filterBy:{name:"",inStock:"",labels:[],sortBy:""}}},methods:{setFilter(){this.$emit("setFilter",JSON.parse(JSON.stringify(this.filterBy)))}}},Be=y(" Stock: "),Ve=y("All"),Ne=y(" Labels: "),Ce=y("On wheels"),Ae=y("Box game"),De=y("Art"),Oe=y("Baby"),Fe=y("Doll"),Re=y("Puzzle"),Pe=y("Outdoor"),Me=y(" Sort By: "),Je=y("Time"),qe=y("Name"),ze=y("Price");function Ge(e,t,s,l,o,n){const r=d("el-input"),u=d("el-option"),m=d("el-select"),C=d("el-form");return c(),b(C,{class:"toy-filter"},{default:p(()=>[a(r,{modelValue:o.filterBy.name,"onUpdate:modelValue":t[0]||(t[0]=$=>o.filterBy.name=$),onInput:n.setFilter,type:"text",placeholder:"Search toy.."},null,8,["modelValue","onInput"]),i("label",null,[Be,a(m,{onChange:n.setFilter,modelValue:o.filterBy.inStock,"onUpdate:modelValue":t[1]||(t[1]=$=>o.filterBy.inStock=$)},{default:p(()=>[a(u,{value:""},{default:p(()=>[Ve]),_:1}),a(u,{label:"In stock",value:"true"}),a(u,{label:"Not in stock",value:"false"})]),_:1},8,["onChange","modelValue"])]),i("label",null,[Ne,a(m,{class:"label-select",onChange:n.setFilter,multiple:"",modelValue:o.filterBy.labels,"onUpdate:modelValue":t[2]||(t[2]=$=>o.filterBy.labels=$)},{default:p(()=>[a(u,{value:"On wheels"},{default:p(()=>[Ce]),_:1}),a(u,{value:"Box game"},{default:p(()=>[Ae]),_:1}),a(u,{value:"Art"},{default:p(()=>[De]),_:1}),a(u,{value:"Baby"},{default:p(()=>[Oe]),_:1}),a(u,{value:"Doll"},{default:p(()=>[Fe]),_:1}),a(u,{value:"Puzzle"},{default:p(()=>[Re]),_:1}),a(u,{value:"Outdoor"},{default:p(()=>[Pe]),_:1})]),_:1},8,["onChange","modelValue"])]),i("label",null,[Me,a(m,{onChange:n.setFilter,modelValue:o.filterBy.sortBy,"onUpdate:modelValue":t[3]||(t[3]=$=>o.filterBy.sortBy=$)},{default:p(()=>[a(u,{value:"createdAt"},{default:p(()=>[Je]),_:1}),a(u,{value:"name"},{default:p(()=>[qe]),_:1}),a(u,{value:"price"},{default:p(()=>[ze]),_:1})]),_:1},8,["onChange","modelValue"])])]),_:1})}var He=h(Le,[["render",Ge]]);const je={name:"toy-app",methods:{setFilter(e){this.$store.dispatch({type:"filter",filterBy:e})}},computed:{toys(){return this.$store.getters.toys}},components:{toyList:xe,toyFilter:He}},Ke={class:"toy-app"},We={class:"toy-app-header"},Ye=y("Add Toy");function Qe(e,t,s,l,o,n){const r=d("router-link"),u=d("toy-filter"),m=d("toy-list");return c(),_("main",Ke,[i("header",We,[a(r,{to:"/toy/edit"},{default:p(()=>[Ye]),_:1}),a(u,{onSetFilter:n.setFilter},null,8,["onSetFilter"])]),n.toys?(c(),b(m,{key:0,toys:n.toys},null,8,["toys"])):S("",!0)])}var Xe=h(je,[["render",Qe]]);const Ze="/api/";var et=J.create({withCredentials:!0});const g={get(e,t){return T(e,"GET",t)},post(e,t){return T(e,"POST",t)},put(e,t){return T(e,"PUT",t)},delete(e,t){return T(e,"DELETE",t)}};async function T(e,t="GET",s=null){try{return(await et({url:`${Ze}${e}`,method:t,data:s,params:t==="GET"?s:null})).data}catch(l){throw console.log(`Had Issues ${t}ing to the backend, endpoint: ${e}, with data: ${s}`),console.dir(l),l.response&&l.response.status===401&&window.location.assign("/login"),l}}const w={save:nt,query:tt,remove:st,getById:ot,getEmptyToy:lt},E="toy";async function tt(e={}){return await g.get(E,e)}async function ot(e){return await g.get(`${E}/${e}`)}async function st(e){return await g.delete(`${E}/${e}`)}async function nt(e){return await e._id?rt(e):at(e)}async function rt(e){return await g.put(`${E}/${e._id}`,e)}async function at(e){return await g.post(E,e)}function lt(){return{name:"",price:123,labels:[],inStock:!0}}const it={components:{},created(){},data(){return{toyToEdit:{}}},watch:{"this.$route.params.toyId":{async handler(){const e=this.$route.params.toyId;e?this.toyToEdit=await w.getById(e):this.toyToEdit=w.getEmptyToy()},immediate:!0}},methods:{saveToy(){this.$router.push("/toy"),this.$store.dispatch({type:"saveToy",toy:this.toyToEdit})}},computed:{},unmounted(){}},ut=i("button",{class:"btn"},"save",-1);function ct(e,t,s,l,o,n){return c(),_("section",null,[i("pre",null,"            "+v(o.toyToEdit)+`\r
        `,1),i("form",{onSubmit:t[2]||(t[2]=k((...r)=>n.saveToy&&n.saveToy(...r),["prevent"]))},[L(i("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=r=>o.toyToEdit.name=r),placeholder:"Name"},null,512),[[B,o.toyToEdit.name]]),L(i("input",{type:"number","onUpdate:modelValue":t[1]||(t[1]=r=>o.toyToEdit.price=r),placeholder:"Price"},null,512),[[B,o.toyToEdit.price]]),ut],32)])}var dt=h(it,[["render",ct]]);const V="review",O={query:pt,addReview:_t,removeReview:mt,getEmptyReview:yt};async function pt(e){return await g.get(V,e)}async function _t(e){return console.log(e),await g.post(V,e)}async function mt(e){return await g.delete(`${V}/${e}`,e)}function yt(){return Promise.resolve({userId:"",toyId:"",content:"",rate:0})}const ht={emits:["saveReview"],components:{},async created(){this.review=await O.getEmptyReview()},data(){return{review:{}}},methods:{onSaveReview(){this.$emit("saveReview",this.review)}},computed:{},unmounted(){}},gt=i("button",{class:"btn save"},"Save",-1);function ft(e,t,s,l,o,n){const r=d("el-input"),u=d("el-form");return c(),b(u,{onSubmit:k(n.onSaveReview,["prevent"])},{default:p(()=>[a(r,{modelValue:o.review.content,"onUpdate:modelValue":t[0]||(t[0]=m=>o.review.content=m),type:"text",placeholder:"What did you think of the toy?"},null,8,["modelValue"]),gt]),_:1},8,["onSubmit"])}var vt=h(ht,[["render",ft]]);const $t="",f=bt();window.socketService=f;f.setup();function bt(){var e=null;return{async setup(){e=q($t)},on(s,l){e.on(s,l)},off(s,l=null){!e||(l?e.off(s,l):e.removeAllListeners(s))},emit(s,l){e.emit(s,l)},terminate(){e=null}}}const wt={props:["toyId","currUser"],components:{},created(){f.setup(),f.emit("chat topic",this.topic),f.on("chat addMsg",this.addMsg),f.on("user-is-typing",this.setTypingName)},destroyed(){f.off("chat addMsg",this.addMsg),f.terminate()},data(){return{msg:{from:"Me",txt:""},msgs:[],room:this.toyId,typingName:""}},methods:{addMsg(e){console.log(this.msgs),this.msgs.push(e)},sendMsg(){var e;console.log("Sending",this.msg),this.msg.from=(e=this.currUser)!=null&&e.fullname?this.currUser.fullname:"Guest",f.emit("chat newMsg",this.msg),this.msg={from:"Me",txt:""}},onInput(){var e;f.emit("chat userTyping",(e=this.currUser)==null?void 0:e.fullname)},setTypingName(e){this.typingName=e}}},St={class:"chat-room-container"},It={class:"msgs-container"},kt={key:0},Et=i("button",{class:"btn send-btn"},"Send",-1);function Tt(e,t,s,l,o,n){return c(),_("section",St,[i("ul",It,[(c(!0),_(I,null,D(o.msgs,r=>(c(),_("li",null,[i("span",null,v(r.from)+":",1),y(" "+v(r.txt),1)]))),256))]),o.typingName?(c(),_("span",kt,v(o.typingName)+" is typing...",1)):S("",!0),i("form",{onInput:t[1]||(t[1]=(...r)=>n.onInput&&n.onInput(...r)),id:"msg-input",onSubmit:t[2]||(t[2]=k((...r)=>n.sendMsg&&n.sendMsg(...r),["prevent"]))},[L(i("input",{id:"input",type:"text","onUpdate:modelValue":t[0]||(t[0]=r=>o.msg.txt=r)},null,512),[[B,o.msg.txt]]),Et],32)])}var Ut=h(wt,[["render",Tt]]);const xt={components:{addReview:vt,chatRoom:Ut},data(){return{toy:{}}},watch:{"this.$route.params.toyId":{async handler(){try{const e=await w.getById(this.$route.params.toyId);this.toy=e}catch{console.log("Couldnt get toy for details"),this.$store.commit({type:setIsError,isError:!0})}},immediate:!0}},methods:{onSaveReview(e){const t=this.$store.getters.loggedInUser;e.toyId=this.toy._id,e.userId=t._id,O.addReview(e)}},computed:{loggedInUser(){return this.$store.getters.loggedInUser}},unmounted(){}},Lt={class:"toy-details"};function Bt(e,t,s,l,o,n){const r=d("add-review"),u=d("chat-room");return c(),_("section",Lt,[i("pre",null,"            "+v(o.toy)+`\r
        `,1),a(r,{onSaveReview:n.onSaveReview},null,8,["onSaveReview"]),a(u,{toyId:o.toy._id,currUser:n.loggedInUser},null,8,["toyId","currUser"])])}var Vt=h(xt,[["render",Bt]]);z.register(...G);const Nt={name:"dashboard-chart",props:{labels:Array,chartData:Array},computed:{testData(){return{labels:this.labels,datasets:[{data:this.chartData,backgroundColor:["#77CEFF","#0079AF","#123E6B","#97B0C4","#A5C8ED"]}]}}},components:{DoughnutChart:H}};function Ct(e,t,s,l,o,n){const r=d("DoughnutChart");return c(),b(r,{chartData:n.testData},null,8,["chartData"])}var At=h(Nt,[["render",Ct]]);const Dt={data(){return{labels:this.$store.getters.labels}},components:{dashboardChart:At},created(){console.log(this.$store.getters.toys)},computed:{pricesByType(){const e=(t,s)=>t+s.price;return this.$store.getters.detailByType(e)},stockByType(){const e=(t,s)=>s.inStock?++t:t;return this.$store.getters.detailByType(e)}}},Ot={class:"dashboard-container"},Ft={class:"dashboard-chart"},Rt=i("h2",null,"Total price of items by type:",-1),Pt={class:"dashboard-chart"},Mt=i("h2",null,"Total stock of items by type:",-1);function Jt(e,t,s,l,o,n){const r=d("dashboard-chart");return c(),_("main",Ot,[i("div",Ft,[Rt,a(r,{labels:o.labels,chartData:n.pricesByType},null,8,["labels","chartData"])]),i("div",Pt,[Mt,a(r,{labels:o.labels,chartData:n.stockByType},null,8,["labels","chartData"])])])}var qt=h(Dt,[["render",Jt]]);function zt(e){const t=sessionStorage.getItem(e);return t?JSON.parse(t):null}function Gt(e,t){sessionStorage[e]=JSON.stringify(t)}const F={load:zt,save:Gt},R="userLocDB",U={save:Ht,getLoggedInUser:jt};function Ht(e){return F.save(R,e)}function jt(){return F.load(R)}const x={login:Wt,logout:Yt,signup:Qt},Kt="/api/auth/";console.log(Kt);const N="auth";async function Wt(e){try{const t=await g.post(`${N}/login`,e);return U.save(t),Promise.resolve(t)}catch(t){throw console.log("Couldnt login",t),t}}async function Yt(){try{return await g.post(`${N}/logout`),U.save(null),Promise.resolve()}catch(e){throw console.log(e),e}}async function Qt(e){try{const t=await g.post(`${N}/signup`,e);return U.save(t),t}catch(t){throw console.log("Couldnt login",t),t}}const Xt={emits:["login"],components:{},created(){},data(){return{user:{username:"",password:""}}},methods:{onLogin(){this.$emit("login",this.user)}},computed:{},unmounted(){}},Zt=i("h2",null,"Login:",-1),eo=i("button",null,"Login",-1);function to(e,t,s,l,o,n){const r=d("el-input"),u=d("el-form");return c(),_(I,null,[Zt,a(u,{class:"login-form",onSubmit:k(n.onLogin,["prevent"])},{default:p(()=>[a(r,{type:"text",placeholder:"Username",modelValue:o.user.username,"onUpdate:modelValue":t[0]||(t[0]=m=>o.user.username=m)},null,8,["modelValue"]),a(r,{type:"password",placeholder:"Password",modelValue:o.user.password,"onUpdate:modelValue":t[1]||(t[1]=m=>o.user.password=m)},null,8,["modelValue"]),eo]),_:1},8,["onSubmit"])],64)}var oo=h(Xt,[["render",to]]);const so={emits:["signup"],data(){return{user:{fullname:"",username:"",password:""}}},methods:{onSignup(){this.$emit("signup",this.user)}}},no=i("h2",null,"Signup:",-1),ro=i("button",null,"signup",-1);function ao(e,t,s,l,o,n){const r=d("el-input"),u=d("el-form");return c(),_(I,null,[no,a(u,{class:"signup-form",onSubmit:k(n.onSignup,["prevent"])},{default:p(()=>[a(r,{type:"text",placeholder:"Full Name",modelValue:o.user.fullname,"onUpdate:modelValue":t[0]||(t[0]=m=>o.user.fullname=m)},null,8,["modelValue"]),a(r,{type:"text",placeholder:"Username",modelValue:o.user.username,"onUpdate:modelValue":t[1]||(t[1]=m=>o.user.username=m)},null,8,["modelValue"]),a(r,{type:"password",placeholder:"Password",modelValue:o.user.password,"onUpdate:modelValue":t[2]||(t[2]=m=>o.user.password=m)},null,8,["modelValue"]),ro]),_:1},8,["onSubmit"])],64)}var lo=h(so,[["render",ao]]);const io={components:{login:oo,signUp:lo},computed:{loggedInUser(){return this.$store.getters.loggedInUser}},methods:{async onLogin(e){try{await this.$store.dispatch({type:"login",user:e}),console.log("Logged in successfully!"),this.$router.push("/")}catch(t){console.log(t)}},async onLogout(){try{await this.$store.dispatch({type:"logout"}),console.log("Logged out succesfully!")}catch(e){console.log(e)}},async onSignup(e){try{await this.$store.dispatch({type:"signup",user:e}),console.log("Signed up succesfully!"),this.$router.push("/")}catch(t){console.log(t)}}}},uo={class:"login-logout-signup-container"},co={key:1,class:"login-signup-container"};function po(e,t,s,l,o,n){const r=d("login"),u=d("sign-up");return c(),_("section",uo,[n.loggedInUser?(c(),_("button",{key:0,class:"btn",onClick:t[0]||(t[0]=(...m)=>n.onLogout&&n.onLogout(...m))},"Logout")):(c(),_("div",co,[a(r,{onLogin:n.onLogin},null,8,["onLogin"]),a(u,{onSignup:n.onSignup},null,8,["onSignup"])]))])}var _o=h(io,[["render",po]]);const mo=j({history:K(),linkActiveClass:"active",routes:[{path:"/",name:"home",component:qt},{path:"/toy",name:"toy-app",component:Xe},{path:"/toy/:toyId",name:"toy-details",component:Vt},{path:"/toy/edit/:toyId?",name:"toy-edit",component:dt},{path:"/about",name:"about"},{path:"/user",name:"user",component:_o}]});var yo={strict:!0,state:{toys:[],filterBy:{},labels:["On wheels","Box game","Art","Baby","Doll","Puzzle","Outdoor","Battery Powered"]},getters:{toys(e){return JSON.parse(JSON.stringify(e.toys))},labels(e){return JSON.parse(JSON.stringify(e.labels))},detailByType:e=>t=>{if(!!e.toys.length)return e.labels.reduce((s,l)=>(s.push(e.toys.filter(o=>o.labels.includes(l)).reduce(t,0)),s),[])}},mutations:{setToys(e,{toys:t}){e.toys=t},removeToy(e,{_id:t}){const s=e.toys.findIndex(l=>l._id===t);e.toys.splice(s,1)},setFilter(e,{filterBy:t}){e.filterBy=t},saveToy(e,{savedToy:t}){const s=e.toys.findIndex(l=>l._id===t._id);s!==-1?e.toys.splice(s,1,t):e.toys.unshift(t)}},actions:{async loadToys({commit:e,state:t}){try{e({type:"setIsLoading",isLoading:!0});const s=await w.query(t.filterBy);e({type:"setToys",toys:s}),e({type:"setIsLoading",isLoading:!1})}catch{e({type:"setIsError",isError:!0})}},async removeToy({commit:e},t){try{await w.remove(t._id),e(t)}catch(s){console.log("Couldnt remove toy",s),e({type:"setIsError",isError:!0})}},async saveToy({dispatch:e},t){try{await w.save(t.toy),e("loadToys")}catch(s){console.log("Couldnt save toy",s),commit({type:"setIsError",isError:!0})}},filter({commit:e,dispatch:t},{filterBy:s}){e({type:"setFilter",filterBy:s}),t({type:"loadToys"})}}},ho={strict:!0,state:{loggedInUser:null},getters:{loggedInUser(e){return JSON.parse(JSON.stringify(e.loggedInUser))}},mutations:{loadLoggedInUser(e){e.loggedInUser=U.getLoggedInUser()}},actions:{async login({commit:e},{user:t}){console.log(t);try{const s=await x.login(t);e("loadLoggedInUser")}catch{e({type:"setIsError",isError:!0})}},async logout({commit:e}){try{await x.logout(),e("loadLoggedInUser")}catch{e({type:"setIsError",isError:!0})}},async signup({commit:e},{user:t}){try{const s=await x.signup(t);e("loadLoggedInUser")}catch{e({type:"setIsError",isError:!0})}}}};const go=W({strict:!0,state:{isLoading:!0,isError:!1},getters:{isError({isError:e}){return e}},mutations:{setIsLoading(e,{isLoading:t}){e.isLoading=t},setIsError(e,{isError:t}){e.isError=t}},modules:{toyStore:yo,userStore:ho}});Y(me).use(mo).use(go).use(Q).mount("#app");
